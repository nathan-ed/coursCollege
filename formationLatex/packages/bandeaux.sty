% author : sylcha
% licence : Creative Commons Attribution-NonCommercial-ShareAlike 4.0
%           https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode
% purpose : positionnement des éléments de titres dans les marges
\ProvidesPackage{bandeaux}%
\RequirePackage{nopageno}%
\RequirePackage{background}%
\RequirePackage{ifoddpage}%
\RequirePackage{tikzpagenodes}%
% options 
\RequirePackage{kvoptions} % key-value options pour passer titre, thème etc
\newcommand{\TypeTitle}{SE SOUVENIR}%
\newcommand{\TypeIcon}{\faBrain}%
\DeclareVoidOption{exercices}{%
  \renewcommand{\TypeTitle}{EXERCICES}%
  \renewcommand{\TypeIcon}{\faPencil*}%
}%
\DeclareVoidOption{rappels}{%
\renewcommand{\TypeTitle}{RAPPELS}%
\renewcommand{\TypeIcon}{\faCompass}%
}%
\DeclareVoidOption{objectif}{%
  \renewcommand{\TypeTitle}{OBJECTIF}%
  \renewcommand{\TypeIcon}{\faBullseye}%
}%
\DeclareVoidOption{fiche}{%
  \renewcommand{\TypeTitle}{FICHE N°}%
  \renewcommand{\TypeIcon}{\faCogs}%
}%
\DeclareVoidOption{serie}{%
  \renewcommand{\TypeTitle}{EXERCICES}%
  \renewcommand{\TypeIcon}{\faDumbbell}%
}%
\DeclareVoidOption{finale}{%
\renewcommand{\TypeTitle}{SE TESTER}%
\renewcommand{\TypeIcon}{\faMedal}%
}%
\DeclareVoidOption{memoire}{%
\renewcommand{\TypeTitle}{MÉMORISER}%
\renewcommand{\TypeIcon}{\faBrain}%
}%
\DeclareDefaultOption{\PackageWarning{bandeaux}{Unknown '\CurrentOption'}}%
\DeclareStringOption[SIXIÈME]{niveau}%
\DeclareStringOption[101]{nfiche}
\DeclareStringOption[2024--2025]{annee}
\DeclareStringOption[ns]{auteur}
\DeclareStringOption[Mon Thème]{theme}%
\DeclareBoolOption[false]{nopagenumber}%
\ProcessKeyvalOptions*%
  \backgroundsetup{%
  scale=1,%
  opacity=1,%
  angle=0,%
  contents={%
  \begin{tikzpicture}[remember picture,overlay]%
    \node[DarkGray, anchor=west] at (current page footer area.west) {%
    \bandeaux@annee};
  \node[DarkGray, anchor=east] at (current page footer area.east) {%
	\hfill \bandeaux@auteur};%
    \node[DarkGray] at (current page footer area) {%
	    \ifbandeaux@nopagenumber{}\else{\thepage/\pageref{LastPage}}\fi
    };%
  \end{tikzpicture}%
  }}%
 
\AtBeginDocument{%
\begin{tikzpicture}[remember picture,overlay]
    % Add a rounded rectangle frame
    \draw[line width=1pt, rounded corners=5pt] 
      ([xshift=5mm,yshift=-5mm]current page.north west) 
      rectangle 
      ([xshift=-5mm,yshift=-20mm]current page.north east);

    % Icon
    \node[rectangle, rounded corners=5pt, minimum height=1cm, minimum width=2cm, fill=white, text=black] 
      (symbole) at ([xshift=15.2mm, yshift=-10.2mm]current page.north west) {\large \bandeaux@niveau};

    % Title
    \node[below=-2mm of symbole.south west, anchor=north west, inner sep=4pt, outer sep=0pt] 
      (type) {\titlefont \TypeTitle \bandeaux@nfiche};

    % Theme (centered in the box)
    \node[anchor=center] (theme) at ([yshift=-13mm]current page.north) 
      {\Large \bandeaux@theme};
\end{tikzpicture}
  \par%
}

